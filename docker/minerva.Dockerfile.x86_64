FROM mcr314/minerva_ruby_openssl:v202205 as builder

WORKDIR /app
RUN apt-get update

RUN apt-get install -y libpq-dev libsqlite3-dev

# install gems with extensions explicitely so that layers are cached.
RUN gem install -v1.13.5 nokogiri --source=http://rubygems.org && \
    gem install -v1.2.7 eventmachine --source=http://rubygems.org && \
    gem install -v2.5.8  nio4r --source=http://rubygems.org && \
    gem install -v3.1.16 bcrypt --source=http://rubygems.org && \
    gem install -v1.14.2 ffi --source=http://rubygems.org && \
    gem install -v0.21.0 pg --source=http://rubygems.org && \
    gem install -v1.8.1  thin --source=http://rubygems.org && \
    gem install -v0.1.5  websocket-extensions --source=http://rubygems.org && \
    gem install -v0.7.3  websocket-driver     --source=http://rubygems.org && \
    gem install -v0.5.9.6 cbor --source=http://rubygems.org && \
    gem install -v1.4.2  sqlite3 --source=http://rubygems.org && \
    gem install -v2.6.2  json --source=http://rubygems.org

RUN apt-get install -y busybox
