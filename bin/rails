#!/usr/bin/env ruby
APP_PATH = File.expand_path('../../config/application', __FILE__)
require_relative '../config/boot'

require 'openssl'
require 'webrick'
require 'webrick/https'
require 'byebug'


# THIS IS NEW:
require "rails/commands/server"
module Rails
  class Server
    def default_options
      settings = {
        :BindAddress => '::2',
        :ServerAlias => ['fountain-test.sandelman.ca', 'localhost', 'fountain.sandelman.ca'],
        :SSLEnable => true,
        :SSLCertificate => OpenSSL::X509::Certificate.new(File.read('db/cert/jrc_prime256v1.crt')),
        :SSLPrivateKey => OpenSSL::PKey.read(File.read('db/cert/jrc_prime256v1.key'))
      }
      if $COAPServer
        settings[:Port] = 5683
      else
        settings[:Port] = 443
      end
      super.merge(settings)
    end
  end
end


require 'rails/commands'
